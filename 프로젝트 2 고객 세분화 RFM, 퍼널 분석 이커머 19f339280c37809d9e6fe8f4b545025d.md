# 프로젝트 2. 고객 세분화 RFM, 퍼널 분석 이커머스 SQL 프로젝트

### 주제:  이커머스**의 고객 전환율 향상을 위한 고객 세분화 및 리텐션 분석과 퍼널 분석**

## 1. 프로젝트 소개

Maven Fuzzy Factory는 3년 동안 서비스를 운영해온 이커머스 플랫폼입니다. 고객 기반이 확대되었지만 VIP 고객의 이탈이 많이 발생하고 있으며 이탈률을 줄이는 것이 사업 성장의 핵심 과제로 떠오르고 있습니다. 

전자 상거래(E-commerce) 또는 리테일 비즈니스에서 고객 리텐션을 최적화하고, VIP 고객을 식별하여 맞춤형 마케팅 전략을 수립하기 위해, 고객 세분화와 구매 행동을 RFM 분석, 퍼널 분석, 리텐션 분석 등의 마케팅 분석 방법을 이용하여 분석을 진행하였습니다. 

- 상황:  MavenFuzzyFactory사의 전체 고객 중 VIP 고객 수의 비율은 10% 이나, VIP 고객이 발생시키는 매출은 전체 매출의 17%이다. 분석하고자 하는 Maven 사는 인형을 판매하는 소규모 소매 이커머스이다. 크리스마스와 신년이 포함된 2015년의 Q4(9~12월), Q1(1월~3월) 기간 동안 VIP 고객 수와 VIP 고객의 구매 수와 구매 빈도를 더 높여 매출을 성장시키고자 한다.
- 연구에 따르면 반복 구매 고객이 기업 매출의 40% 이상을 창출할 수 있으며, 고객 유지율을 5% 증가시킬 때 수익이 25-95% 증가할 수 있다는 것을 참고하여 Maven 사는 VIP 고객의 수를 늘리고, VIP 고객의 지표를 개선하는 마케팅 플랜을 세우기 전에 추세와 현황 파악을 파악하고자 한다.

**[분석에 사용한 데이터]**

https://www.kaggle.com/code/rubenman/maven-fuzzy-factory

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image.png)

## 2. **문제 정의**

- 고객의 구매 패턴을 파악하고 세분화할 필요가 있다.
- 재구매 고객이 떨어짐 → 고객 세분화를 통해서 일반 고객과 VIP 구매 행동에 차이가 있는지? 어떤 마케팅을 해야 고객의 재구매를 높일 수 있을까?
- VIP 고객군을 정의하고 유지율(Retention Rate)을 높일 방법을 찾아야 함.
- 신규 구매 고객의 구매 행동을 분석하여 효과적인 유입 전략을 수립해야 함.

## 3. **목적**

1. 고객을 세분화하고 구매 행동(Recency, Frequency, Monetary) 분석을 통한 고객 관리
    - VIP 고객군 vs Non_VIP를 RFM 기준으로 정의하고, 유지율 및 구매 행동을 분석하여 충성도를 높이는 전략을 마련
    - 신규 방문자 중 구매 고객의 특성을 파악하여 전환율을 높이는 방법을 모색
2. 고객 구매 전환율 최적화
    - 전체 퍼널 분석을 통해 고객 유입부터 구매까지의 흐름을 최적화

## **4. 분석 방법 및 필요한 데이터**

### 1) **고객 세분화 및 고객 등급 정의**

| 고객 등급  | 코드 명칭 | 정의  |
| --- | --- | --- |
| VIP | VIP | 전체 고객의 평균 구매 금액 * 1.5 배 이상 구매한 고객  |
| 일반고객 | Non_VIP  | 구매 이력은 있으나 VIP 가 아닌 고객 |
| 신규구매고객 | New_Customers | 1년 단위로 구분해서 이전 연도에 구매한 적이 없다가 새로 구매한 고객 |
| 잠재적 고객 | Non_Buyer | 구매 이력이 없는 고객  |

**VIP 고객 세분화 조건 로직 : 최근 3년간 주문 기준, 전체 고객의 평균 주문 금액 × 1.5배 이상 소비한 고객**

- **장점:** 고객별 장기적인 소비 성향을 반영. 1년 기준 주문액과 3년 기준 주문액의 분포가 유사하여 트렌드 파악에 문제가 없음. 비즈니스 성장이나 성장에 따라 평균 주문 금액이 변동되면서 VIP 기준이 유동적으로 조절 됨. 구매 기준 기간이 길어짐에 따라 고객 별 구매 횟수(Frequency)를 살펴볼 수 있다.
- **단점:** 최근 구매 빈도가 낮은 고객이 포함될 가능성 있다.

**[최근 3년간, 1년간 주문액에 대한 분포도]**

![스크린샷 2025-02-17 오후 2.16.21.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2025-02-17_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.16.21.png)

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%201.png)

### 📌 분석할 데이터:

- 신규 vs 기존 고객 여부
- VIP 고객 정의 기준(예: 전체 구매 금액 평균의 1.5배 이상 지불한 구매자)
    - 이유: 기존에 VIP를 1년 단위를 기준으로 매출 50% 이상 차지하는 고객들을 VIP로 선정하고자 했으나, 고객 간 제품 구매 수, 구매 가격에 대한 차이가 유의미하지 않아 VIP 수가 1년 단위 제품 구매 고객의 약 4~50%를 차지하게 됨 → 운영한 지 3년 밖에 되지 않았다는 점과 구매 빈도가 적은 인형이라는 점을 고려하여 3년 전체 고객 평균 구매 금액의 1.5배 이상을 구매한 고객들을 VIP로 정의함.

---

### 2) **전체 고객 및 VIP 그룹의 리텐션 분석 - 유지율**

### 📌 분석할 데이터:

- 일반고객, VIP 고객군의 **롤링 리텐션**을 분석 비교
    - 참고
        - **클래식 리텐션(Classic Retention)**: 특정 기준일(예: 첫 구매일)에 가입한 사용자 중, 이후 특정 기간(예: N일, N주, N개월) 후에도 활동을 유지한 비율.
        - **롤링 리텐션(Rolling Retention)**: 특정 기준일에 가입한 사용자 중, 특정 날짜까지 **한 번이라도** 재방문한 비율.

---

### 3) **세분화된 고객 등급별 구매 행동 분석**

### 📌 분석할 데이터(RFM: Recency Frequency Monetary 분석)

- 목적: 소비자 데이터 경향성 파악 통한 비즈니스 성장 전략에 지원
- 구매 금액, 구매 건수,  평균 구매 금액, 구매자 수,  평균 구매 제품 수
    - 가장 최근 3개월
    - 지난 3년간 분기별 추세변화

---

### 4) **신규 방문자 구매 행동 분석**

### 📌 분석할 데이터:

- 신규 구매 고객 수
- 신규 구매 고객의 평균 주문 금액(AOV) 및 평균 제품 구매 수
- 신규 구매 고객이 구매한 제품 비율

---

### 5) **퍼널 분석(Funnel Analysis) - 이탈률**

### 📌 분석할 데이터:

- 방문 → 장바구니 추가 → 결제 완료까지 단계별 이탈률
    - 고객 분류에 따라 나누어서 단계별 이탈률을 분석 실시
- 특정 단계에서의 이탈률
- VIP 고객과 다른 고객의 퍼널 차이 분석 (세그먼트)

---

## 5. 분석 결과

### **분기별 구매고객 추세변화**

- **목적**: 본격적으로 인사이트 도출을 위한 소비자 데이터 분석 전, 고객 행동의 경향성 파악을 통해 구매고객의 데이터 추세 파악

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%202.png)

- **전체 기간:** 2012년 3월 - 2015년 3월
- 구매 고객을 VIP, 일반 고객 두 그룹으로 나누어 총 구매 금액, 구매 건수, 고객 수, 일반 고객과 VIP 비율, 고객 1인당 구매 빈도, 고객 1인당 구매액으로 분기별 구매 고객의 추세를 나타낸다.
    - **해석:** MavenFuzzyFactory 이커머스가 성장하면서 VIP 회원이 늘어남에 따라, 구매액, 주문 건수, 고객 수가 늘어나고 있으나, VIP 고객 1인당 지표 - 고객 1인당 구매 빈도(주문 건수/고객 수), 고객 1인당 구매액(구매액/고객 수) 는 성장하지 못하고 있다. → 고객 1인당 구매 빈도와 구매액을 늘릴 수 있는 방법은 무엇일까?

### 전체 고객 및 VIP 그룹의 리텐션 분석 - 유지율

- **고객의 주문 건(구매)** 을 기준으로 **롤링 리텐션**을 계산
    
     롤링 리텐션(Rolling Retention): 특정 기준일에 가입한 사용자 중, 특정 날짜까지 한 번이라도 재구매 또는 방문한 비율
    
- 리텐션의 정의: 이커머스는 판매 제품에 따라 구매 주기가 한 달 보다 길 수 있으므로, 고객마다 첫 번째 달과 마지막 구매 달을 산정하여 리텐션 계산

**설명**

첫 주문 달을 기준으로, 첫 달(month0)에 구매를 한 고객 수 집계

(month1) 첫 번째 달에도 구매하고 두 번째 달에도 구매한 고객 수 집계

(month2) 첫 번째 달에 구매하고 세 번째 달에도 구매한 고객 수 집계. 두 번째 구매 여부는 상관 없음

(month3) 첫 번째 달에 구매하고 네 번째 달에도 구매한 고객 수 집계. 두 번째, 세 번째 달  구매 여부는 상관 없음

**[전체 고객의 Retention 비율 계산을 위한 구매 건 수 집계 & Retention 비율]**

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%203.png)

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/2e5430be-46f8-42ef-a827-6e15a56dc76b.png)

**[VIP 고객의 Retention 비율 계산을 위한 구매 건 수 집계 & Retention 비율]** 

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%204.png)

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%205.png)

**데이터 요약**

- **해석**: 일반 고객의 첫 구매 달부터 마지막 구매 달까지의 구매 리텐션은  month1, month2 기준 1%에 불과하였으나, VIP 고객의 구매 리텐션은 첫 구매 달로부터 month1, month2, month3, month4 각각 41%, 18%, 3%, 1%였다.
- **결론**(Action Item): 일반 고객과 VIP 고객의 구매 행동 패턴이나 인구 통계적 특성에서 차이가 있는 지 확인이 필요하다. 정기적으로 VIP고객의 리탠션을 확인 하여, VIP 고객의 리탠션 높은 원인이 무엇인지 파악이 필요하다.

**결론: 추가로 분석해볼 수 있는 데이터 포인트**

- **고객 세그먼트별 비교 (RFM 분석) -** 재구매 가능성이 높은 고객군 파악
    - 고객당 평균 구매액 (AOV, Average Order Value) = 총 매출 ÷ 주문 수
    - 고객당 구매 제품 개수 (UPM, Unit per Member) = 판매 제품 개수 ÷ 고객 수
    - 평균 재구매 횟수 = 고객당 평균 주문 건수
- **신규 방문자 구매 행동 분석**
- 제품별 유지율 분석: 특정 제품이 유지율에 미치는 영향 분석
- **퍼널분석**을 통해 일반 고객의 이탈 원인과 VIP 고객의 이탈 원인이 같은 지 검증 필요.

### RFM 고객 세분화 분석

- **목적**: 본격적으로 인사이트 도출을 위한 소비자 데이터 분석 전, 고객 행동의 경향성 파악을 통해 세그먼트 별로 고객 행동을 파악. 고객 관리 마케팅이 매출로 이어질 수 있도록 도움을 주기 위함.

**최근 3개월 구매 고객 행동 분석 (VIP 고객과 Non-VIP 고객)**

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%206.png)

**데이터 요약**

- 기간: 2014-12-19 ~ 2015-03-19(최근 3개월)
- VIP 고객 비중: 15%
- Non-VIP 고객 비중**:** 85%

**인사이트**

- VIP 고객은 전체 고객 중 15%에 불과하며, Non-VIP 고객이 85%로 절대적인 비중을 차지하고 있다. 이는 현재 VIP 고객의 비율이 낮은 것은 VIP로 전환될 가능성이 있는 고객을 효과적으로 식별하고 전환시키는 전략이 부족하다는 점을 의미한다. 이에 따라, Non-VIP 고객 중에서 VIP로 승급할 가능성이 있는 고객을 선별하고, 이들에게 맞춤형 혜택을 제공하여 VIP 전환을 적극적으로 유도하는 전략이 필요하다.

**전략 제안**

- Non_VIP 고객을 VIP 고객으로 유도하기 위한 인센티브(할인, 무료배송)를 제공하는 것이 필요하고 일정 기간 내 **특정 금액 이상**을 소비한 고객을 VIP로 자동 승급하는 **VIP 승급 인센티브 프로그램**을 운영함으로써 자연스럽게 Non_VIP 고객이 자연스럽게 VIP로 전환되도록 유도한다.

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%207.png)

**데이터 요약**

- VIP 고객 평균 주문 금액(AOV): 97 USD
- Non-VIP 고객 평균 주문 금액(AOV): 57 USD
- VIP 고객 AOV가 Non-VIP 고객 대비 ****약 70% 더 높음

**인사이트**

- VIP 고객은 한 번의 구매에서 평균적으로 더 많은 금액을 소비하는 경향이 있다. VIP 고객의 평균 구매 금액이 높은 만큼, 이 고객층을 유지하되 VIP 고객의 절대적인 수가 적어 Non-VIP 고객의 구매 단가를 증가시키는 전략도 필요하다.

**전략 제안**

- VIP 고객의 지속적인 구매를 유도하려면 맞춤형 할인과 멤버십 혜택을 강화하는 것이 중요하다. 동시에 Non-VIP 고객이 일정 기간 내 특정 금액 이상을 구매하면 VIP 등급으로 승격될 수 있도록 인센티브 기반 마케팅을 도입하여 전환율을 높여야 한다. 이를 위해 할인 쿠폰, 추천 리워드, 멤버십 업그레이드와 같은 다양한 프로모션을 활용해야 한다.

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%208.png)

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%209.png)

**데이터 요약**

- VIP 고객 총 매출**:** 97,506 USD
- Non-VIP 고객 총 매출**:** 298,863 USD
- Non-VIP 고객이 ****전체 매출의 75% 차지

**인사이트**

- VIP 고객의 평균 주문 금액이 높음에도 불구하고, 절대적인 고객 수가 적어 총 매출 기여도가 낮다. 반면, Non-VIP 고객은 전체 매출의 75%를 차지하지만, 평균 주문 금액이 낮아 장기적인 성장 전략이 필요하다.

**전략 제안**

- VIP 고객층을 확대하기 위해 일정 금액 이상 구매 시 자동으로 VIP 등급으로 승급되는 인센티브 프로그램을 도입하고, VIP 고객에게는 맞춤형 할인과 독점 혜택을 제공하여 충성도를 높여야 한다.
- 동시에 Non-VIP 고객이 자연스럽게 더 높은 금액을 소비하도록 유도하기 위해 단가가 높은 상품을 추천하거나, 일정 구매 금액을 초과할 경우 추가 할인 혜택을 제공하는 등의 전략을 적용할 필요가 있다.

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2010.png)

**데이터 요약**

- VIP 고객 총 구매 건수: 1,046건
- Non-VIP 고객 총 구매 건수: 5,278건
- VIP 고객이 Non-VIP 고객 대비 ****구매 건수가 1/5 수준

**인사이트**

- VIP 고객은 평균적으로 한 번의 주문에서 높은 금액을 소비하지만, 구매 건수는 낮아 브랜드에 대한 지속적인 충성도를 유지하는 것이 중요하다. 반면, Non-VIP 고객은 비교적 자주 구매하지만, 주문 당 소비 금액이 낮아 개별 구매의 수익성이 VIP 고객에 비해 떨어지는 경향이 있다. 이러한 패턴은 VIP 고객의 지속적인 구매를 유도하는 전략과 Non-VIP 고객의 평균 주문 금액을 높이는 전략이 병행되어야 함을 시사한다.

**전략 제안**

- VIP 고객의 경우 구매 빈도를 높일 수 있도록 일정 기간 내 구매 시 추가 할인 혜택을 제공하거나 VIP 고객 전용 한정판 제품 및 특별 프로모션을 운영하면 구매 건수가 증가할 가능성이 있다
- Non-VIP 고객의 평균 주문 금액을 향상시키기 위해 ****번들 할인, 묶음 판매, 구매 금액별 추가 혜택을 제공하는 전략이 필요하다. 동일 제품을 2개 이상 구매할 경우 할인을 적용하여 추가 구매를 유도하고, 관련 제품을 함께 구매할 시 추가 혜택을 제공하는 방식으로 고객의 장바구니 가치를 높일 수 있다.

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2011.png)

**데이터 요약**

- VIP 고객 평균 구매 제품 개수: 2.1개
- Non-VIP 고객 평균 구매 제품 개수: 1.2개

**인사이트**

- 평균적으로  VIP 고객의 1회 주문 당 구매 개수는 약 2.1개 Non_VIP 고객은 약 1.2개 수준이므로 VIP 고객이 대량 구매를 한다고 보기는 어렵다. 따라서 VIP 고객이 실제로 한 번의 주문에서 더 많은 제품을 구매하도록 유도하는 전략이 필요하고 Non_VIP 고객을 대상으로 추가 구매를 유도해야 한다.

**전략 제안**

- VIP 고객이 한 번의 주문에서 더 많은 제품을 구매할 수 있도록 관련 제품 추가 구매  시 할인을 제공하는 전략을 도입하여 연관 상품을 할인된 가격에 추가 구매할 수 있도록 유도하거나 일정 개수 이상 구매 시 추가 적립 포인트를 제공한다.
- Non_VIP 고객은 추가 구매 유도 쿠폰을 활용하여 2개 구매 시 할인, 무료 배송 등의 혜택을 적용한다.

### 신규 방문자 구매 행동 분석

신규 구매 고객은 MavenFuzzyFactory 회사가 시작된 2012-03-19를 기준으로 1년 단위 별(2012-03-19 ~ 2013-03-18, 2013-03-19 ~ 2014-03-18, 2014-03-19, 2015-03-19)로 이전에 구매한 기록이 없고 해당 기간에 처음 구매한 고객을 신규 구매 고객으로 정의하고 분석을 진행하였다.

1. **신규 구매 고객 수**

**[기간별 신규 고객 수 분석 결과]**

![스크린샷 2025-02-14 오후 2.50.36.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2025-02-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.50.36.png)

**데이터 요약**

- MavenFuzzyFactory의 제품을 1년 단위로 구분된 기간 동안 최초 구매 건수 만을 카운트하여 신규 고객 수를 파악해 본 결과, 기간 별 신규 고객 수가 3,634명 → 8,814명 → 19,217명으로 각 기간 약 142.54%, 약 118.03% 증가하였다.

**전략 제안**

- 단순히 MavenFuzzyFactory의 웹 페이지에 방문하기만 한 고객이 아니라 구매까지 이어진 신규 고객들의 수가 계속 증가하고 있는 상황에서 이들의 재구매를 촉진시켜 충성고객, VIP 등으로 전환하기 위한 방안이 필요하다.

1. **신규 구매 고객의 평균 주문 금액 및 평균 제품 구매 수**

**[기간별 신규 고객 평균 구매액, 평균 제품 구매 개수 분석 결과]**

![스크린샷 2025-02-14 오후 3.05.52.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2025-02-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.05.52.png)

**데이터 요약** 

- 앞서 파악한 신규 고객들의 평균 구매액, 평균 제품 구매 개수를 분석해 본 결과, 신규 고객들의 평균 구매액은 기간별 50.66$ → 55.51$ → 63.79$로 각 기간 약 9.57%, 약 14.92% 증가하며 신규 고객 수와 더불어 유의미하게 증가하고 있음을 확인할 수 있었다.
- 평균 제품 구매 개수의 경우도 기간 별 1개 → 1.09개 →1.35개로 각 기간 9%, 약 23.85% 증가하였지만 대부분의 고객이 보통 한 개의 제품만 구매하며 그 수는 여전히 적다는 한계가 있다.

1. **신규 구매 고객이 구매한 제품 비율**

**[기간별 신규 고객이 구매한 제품의 비율 분석 결과]**

![스크린샷 2025-02-14 오후 2.53.49.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2025-02-14_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.53.49.png)

**데이터 요약** 

- 각 기간별 신규 고객들이 구매한 제품이 해당 기간 신규 고객이 구매한 전체 상품에서 몇 퍼센트를 차지하는지 분석한 결과이다. 신규 고객을 정의한 각 기간 중간에 신제품으로 출시된 상품들은 출시되기 전까지의 시기 동안 집계되지 않았다는 한계가 있지만 신제품 출시 기간을 고려하면 신규 고객 정의와 상충할 수 있어 기존에 정의한 기간을 바탕으로 분석을 진행하였다.
- 신규 고객들은 ‘The Original Mr. Fuzzy’ 제품을 가장 선호하는 것으로 나타났으며, 이 제품의 구매 비율은 시간이 흐르고 신제품이 계속 출시되는 상황에서도 과반 이상을 차지한다는 것을 파악할 수 있었다.

**전략 제안**

- 이를 바탕으로 ‘The Original Mr. Fuzzy’ 제품을  MavenFuzzyFactory의 플래그십 제품으로 내세우며 신규 고객들을 유치하거나, ‘The Original Mr. Fuzzy’ 제품의 특성을 잘 분석하여 추후 신제품에 반영하는 등의 전략을 세울 수 있을 것이다.

### 퍼널 분석

**[설명]**

MavenFuzzyFactory 회사의 웹 사이트에서 물건을 구매하는 절차를 6단계로 나누어서 해당 단계에서 전 단계 대비 남은 고객 수를 계산한 뒤, % 단위로 계산하여 이탈률을 도출했다.

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2012.png)

1단계의 /home과 /lander의 경우 둘 모두 시작점이자 하나의 세션에서 둘 모두를 방문하는 경우는 없었기에 하나로 묶었다.

2단계의 경우 /product를 제외한 둘은 제품 상세 페이지로 유의미한 결과를 얻을 수 없을 것이라고 판단하여 하나로 묶었다.

5단계의 경우 결제한다는 하나의 절차를 두 개로 나뉘어진 것이기 때문에 (둘을 모두 방문한 케이스가 없음) 하나로 묶어서 계산했다.

6단계까지 도달해야 물건을 구매한 것이라고 판단된다.

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2013.png)

각 페이지별 이탈률은 다음 식을 기반으로 작성했다

**[데이터 전체 쿼리 결과 - 전환율]**

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2014.png)

- /home과 /lander-1 페이지의 경우 웹 사이트의 시작이므로 무조건 100%이므로 비율 대신 해당 경로로 방문한 사용자 수를 집계했다.
- 해당 데이터를 유입 경로(UTM_Source)와 고객 유형 세그먼트로 나누어서 시각화 후 비교했다.

**[세그먼트(고객 유형)별로 나누어 이탈률 시각화한 결과]**

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2015.png)

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2016.png)

**[세그먼트(고객 유형)별 방문시간 시각화 결과]**

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2017.png)

**[분석 결과 및 해석]**

**데이터 요약**

<aside>
💡

퍼널 분석 시에 각 단계

![image.png](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%202%20%E1%84%80%E1%85%A9%E1%84%80%E1%85%A2%E1%86%A8%20%E1%84%89%E1%85%A6%E1%84%87%E1%85%AE%E1%86%AB%E1%84%92%E1%85%AA%20RFM,%20%E1%84%91%E1%85%A5%E1%84%82%E1%85%A5%E1%86%AF%20%E1%84%87%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%86%A8%20%E1%84%8B%E1%85%B5%E1%84%8F%E1%85%A5%E1%84%86%E1%85%A5%2019f339280c37809d9e6fe8f4b545025d/image%2012.png)

</aside>

- 전체 고객이 각 단계에서 다음 페이지로 이동하지 않고 세션을 종료했다.
- Non_Buyer의 경우 초기 방문(/home or /lander)에서 구매 완료율(/thank-you)는 0%
    - /products → /cart 에서 큰 이탈 발생(약 25%만 장바구니까지 이동했다.)
    - /billing 단계 까지 가는 비율은 이전 단계의 약 60%지만, 최종 구매까지는 이루어지지 않음 → 결제 단계에서 이탈했다.
- Non_VIP의 경우 전반적으로 높은 전환율을 보였다.
- 각 고객 유형 별로 페이지에 머무르는 시간이 차이가 거의 없다.

**인사이트**

- 전체 고객 이탈이 세션 종료로 이어지는 원인 분석 필요하다.
- VIP 와 Non VIP 간의 전환율과 페이지 체류시간의 차이가 거의 없다.
- VIP의 전환율이 Non VIP보다 낮은 페이지가 존재한다.
- /cart 부터 /shipping, /billing 까지 이탈이 거의 없다는 것으로 구매 의사가 확실하다고 보여지지만 구매 유인책의 부족으로 결제까지 이어지지 않았음으로 보인다.

**전략 제안**

- UI/UX 그리고 로딩 문제 확인 및 개선이 필요
    - 페이지 로딩 속도 및 네비게이션 UX 점검 필요, 특히 결제까지 가는 과정에서 이탈이 크므로 버그나 로딩문제 점검
    - 페이지 탐색 중 뒤로 가는 것이 불가능할 경우 개선이 필요
- Non Buyer들의 이탈률 개선 전략
    - /product → /cart 이탈률 개선
        - 원하는 제품의 부재나 상품 요약 정보 페이지의 결함이 존재하는 지 확인이 필요
        - 제품 요약 페이지 강화
        - 인기 제품 추천 기능 강화
    - /billing 에서의 이탈률 개선
        - 결제 프로세스 간소화 및 개선
        - 결제 신뢰도 강화
- Non VIP들의 VIP 전환 전략 및 VIP 충성도 강화 전략
    - 일반 고객도 VIP로 전환될 가능성이 있음
        - 일반 고객이 VIP로 전환될 가능성이 높기 때문에 VIP 혜택이 있는 멤버십을 강화하여, VIP의 구매행동에 개선이 있는 지 확인 하고, 일반고객도 VIP로 전환될 수 있도록 유도 마케팅을 할 필요
    - VIP들의 충성도를 높이기 위해 다른 고객들과의 차별을 두는 전략이 효과적일 가능성이 있음
        - ex. VIP한정 시크릿 쿠폰 등, /billing 에서 VIP 전용 혜택(전용 할인 혹은 전용 상품 페이지) 제공

**[결론]**

고객들의 이탈률 원인에 대한 분석을 세그멘트 별로 나누어 분석해볼 필요성이 있다. 
일반 고객과 VIP들의 이탈률이 높은 페이지에 대해서 다른 페이지 대비 더 높은 원인과 함께 이탈률을 줄일 방안을 탐색 필요하다.

---

## 6. 최종 결론

### 1. RFM 고객 세분화 분석

 **분기별 구매 고객 추세 변화**

- 일반 고객과 VIP 고객 모두 매출, 주문 수, 고객 수 증가한다.
- VIP 고객 수는 증가했지만, VIP 1인당 구매 빈도와 평균 구매액은 정체되어 있다.
- 고객당 구매 빈도(Buying Frequency) 및 평균 구매 금액(AOV, Average Order Value) 개선 필요하다.

**최근 3개월 구매 고객 행동 분석 (VIP 고객과 Non-VIP 고객)**

- VIP 고객 비율이 낮음(15%) → VIP 고객의 절대적인 수가 적어 총 매출 기여도가 낮다.
- VIP 고객의 평균 주문 금액이 Non_VIP 고객보다 약 70% 높음 → 높은 구매력을 보이는 VIP 고객의 충성도를  유지하는 전략이 중요하다.
- Non_VIP 고객이 전체 매출의 75% 차지 → 주문 횟수는 많지만 평균 주문 금액이 낮아 장기적인 성장 전략이 필요하다.
- VIP 고객의 구매 건수는 Non_VIP 대비 1/5 수준 → VIP 고객의 반복 구매를 유도하는 리텐션 프로그램 도입이 필요하다.
- VIP 고객의 평균 구매 제품 개수는 2.1개, Non-VIP 고객은 1.2개 → VIP 고객이 대량 구매를 한다고 보기 어렵기 때문에 (크로스 셀링)추가 구매를 유도하는 마케팅이 필요하다.

### 2. 신규 방문자 구매 행동 분석

**신규 구매 고객 수 분석**

- 신규 구매 고객 수는 계속해서 증가하고 있고 그 증가율 또한 커지고 있다. → 증가하고 있는 신규 구매 고객들을 충성고객, VIP로 만들기 위한 전략이 필요하다.

**신규 구매 고객의 평균 주문 금액 및 평균 제품 구매 수 분석**

- 신규 구매 고객의 평균 주문 금액과 평균 제품 구매 수 모두 증가하고 있다. 평균 주문 금액의 경우 유의미하게 증가하고 있지만, 평균 제품 구매 수는 증가율만 높을 뿐 대부분의 신규 구매 고객은 약 1개의 제품만 구매하였다.

**신규 구매 고객이 구매한 제품 비율 분석**

- 신규 구매 고객들은 대부분 ‘The Original Mr. Fuzzy’ 제품을 구매하였다. → 해당 제품을 Maven Fuzzy Factory의 플래그십 제품으로 홍보 강화를 통해 신규 고객들을 유치하거나, 제품의 특성을 잘 분석하여 신제품에 반영하는 등의 전략을 세울 수 있다.

### 3. 전체 고객 및 VIP 그룹의 리텐션 분석

**유지율(Retention) 분석 요약**

**[첫구매 후 월별 평균 유지율(재구매 발생)]**

- 기간: 2012년 3월 - 2015년 3월 (3년)

| 구매고객 구분 | 첫구매 달 | 1달 후  | 2달 후 | 3달 후 | 4달 후 |
| --- | --- | --- | --- | --- | --- |
| VIP | - | 41% | 18% |  3% | 1% |
| Non_VIP | - | 1% | 1% | 0% | 0% |
- 첫 구매 이후 지속적인 구매 유지율이 낮음 → 장기적인 고객 유지 전략 필요하다.
    - 장기전략 - ex. 비정기/정기적 고객을 위한 이벤트, 혜택 신설 (온오프라인 구매 할인, 오프라인 이벤트 - 공연, 행사 등)
- 일반 고객 대비 VIP 고객의 평균 구매 빈도가 높지만, 시간이 지나면서 유지율이 감소한다.
- VIP 고객의 첫 구매 후 1개월 차 유지율이 41%지만, 3개월 이후 급격히 하락(3%) 첫 구매 후 일정 기간 내 재구매 유도를 위한 리마케팅 전략 필요하다.
    - 단기전략 - ex. 첫 구매 감사 쿠폰: 첫 구매 이후 한 달간 사용 가능한 10% 쿠폰 등
    

### 4. 퍼널 분석

- 홈페이지 혹은 광고에서 그리고  제품 상세 페이지에서 이탈률이 제일 높았다.
    - Non VIP와 VIP는 홈페이지와 3번 광고에서, Non Buyer는 1번과 4번 광고에서 이탈률이 가장 높았다. 둘 모두 이탈률이 낮았던 2번과 5번 광고의 유사성을 찾고 다른 광고들에도 이와 비슷하게 만들면 이탈률이 줄어들 것이다. 홈페이지의 경우 Non Buyer에게는 이탈률이 낮았으나 Non VIP와 VIP에게는 이탈률이 높은 수치로 보여졌다. 구매자들에게 더욱 친숙한 홈페이지가 필요하다
- 각 페이지별 이탈률이 VIP와 일반 고객 간의 차이가 거의 없다.
    - VIP들의 회사 충성도가 낮아 이들에 대한 혜택이 부족하다는 해석이 가능하다. 이를 보완하기 위해 VIP들을 위한 혜택의 강화 및 마케팅이 효과적이다
- 오래 걸리는 결제 과정 및 사용자들이 뒤로 가지 않고 세션을 종료한다
    - UI/UX 와 로딩 속도 개선 작업이 필요하다
    - 결제 프로세스 간소화 작업이 필요하다
- 각 고객 유형 별로 페이지에 머무르는 시간이 차이가 거의 없다.
    - 일반 고객, 잠재적 고객 모두 VIP로 전환될 가능성이 높기에 이에 대한 맞춤 전략이 효과적일 가능성이 크다

### **5. 보완점  & 아쉬운점**

1. **고객 세분화** 
- 비즈니스의 규모가 큰 성장단계인 이커머스 비즈니스였다면, 더 많은 고객 데이터를 기준으로 Recency, Frequency 를 반영하여 고객 세분화 전략을 세울 수 있었겠지만, 고객 데이터가 충분치 않아 분석에 제한이 있었다.
1. **퍼널 분석 시 end_session_time 데이터의 부재**
- 물건을 구매하기 전에 세션을 종료한 고객들의 마지막 단계에서 페이지에 머무른 시간을 구할 수 없어 고객 이탈 원인을 파악하는데 제한이 있었다.

---

## **Appendix**

- **고객 세분화 로직**
    
    **조건 1: 주문 금액 상위 25%, 최근 1년간 주문한 고객**
    
    - **단점:** 해당 비즈니스가 스타트업 단계(업력: 3년)인 것을 고려했을 때, 최근 1년의 데이터만 반영을 하는 것은 너무 데이터가 제한적이라서 분석이 어려움. 잠재적 VIP 고객(과거 높은 소비 but 최근 구매 X) 제외될 가능성이 있다.
    
    **조건 2: 주문 금액 상위 25%, 최근 3년간 주문한 고객**
    
    - **장점:** 장기적인 소비 패턴을 반영하여 안정적인 VIP 그룹을 설정 가능, 1년 기준 주문액과 3년 기준 주문액의 분포가 유사함. 기준 기간이 길어짐에 따라 고객 별 구매 횟수(Buying Frequency) 를 살펴볼 수 있다.
    - **단점:** 최근 구매 빈도가 낮은 고객이 포함될 가능성이 있음, 상위 25% 기준이 절대적이라 업계 상황에 따라 적절하지 않을 수 있다.
    
    **✅ 채택한 조건 - 조건 3: 전체 고객의 평균 주문 금액 × 1.5배 이상 소비한 고객, 최근 3년간 주문** 
    
    - **장점:** 고객별 장기적인 소비 성향을 반영. 1년 기준 주문액과 3년 기준 주문액의 분포가 유사하여 트랜드 파악에 문제가 없음. 비즈니스 성장이나 성장에 따라 평균 주문 금액이 변동되면서 VIP 기준이 유동적으로 조절 됨. 구매 기준 기간이 길어짐에 따라 고객 별 구매 횟수(Buying Frequency) 를 살펴볼 수 있다.
    - **단점:** 최근 구매 빈도가 낮은 고객이 포함될 가능성 있다.

- **프로젝트 코드**
    1. **고객 세분화 및 고객 등급 정의**
        - **최근 1년간, 3년간 주문액**
            
            ```sql
            #최근 1년간 주문액
            SELECT 
                price_usd 
            FROM orders 
            WHERE created_at BETWEEN '2014-03-19' AND '2015-03-19';
            
            #최근 3년간 주문액
            SELECT 
                price_usd 
            FROM orders 
            WHERE created_at BETWEEN '2012-03-19' AND '2015-03-19';
            ```
            
    
    1. **전체 고객 및 VIP 그룹의 리텐션 분석 - 유지율**
        - **전체 고객 및 VIP 그룹의 리텐션 분석(롤링리텐션)**
            
            ```sql
            #전체고객 rolling retention
            WITH firstlast_order AS (
            	SELECT DISTINCT user_id, min(created_at) AS first_ord_date, max(created_at) AS last_ord_date
            	FROM orders
            	GROUP BY user_id
            	),
            user_od AS(
            	SELECT o.user_id
            	, DATE_FORMAT(fo.first_ord_date,'%Y-%m-01')AS first_order_month
            	, DATE_FORMAT(fo.last_ord_date,'%Y-%m-01')AS last_order_month
              FROM firstlast_order fo
              LEFT JOIN orders o ON o.user_id = fo.user_id
            )
            SELECT first_order_month
            		, COUNT(DISTINCT user_id) AS month0
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 1 MONTH) <= last_order_month THEN user_id END) AS month1
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 2 MONTH) <= last_order_month THEN user_id END) AS month2
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 3 MONTH) <= last_order_month THEN user_id END) AS month3
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 4 MONTH) <= last_order_month THEN user_id END) AS month4
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 5 MONTH) <= last_order_month  THEN user_id END) AS month5
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 6 MONTH) <= last_order_month  THEN user_id END) AS month6
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 7 MONTH) <= last_order_month  THEN user_id END) AS month7
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 8 MONTH) <= last_order_month  THEN user_id END) AS month8
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 9 MONTH) <= last_order_month  THEN user_id  END) AS month9
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 10 MONTH) <= last_order_month  THEN user_id END) AS month10
            	     , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 11 MONTH) <= last_order_month THEN user_id END) AS month11
            FROM user_od
            GROUP BY first_order_month ORDER BY first_order_month ;
            
            #VIP rolling retention
            
            WITH Avg_price AS (
                SELECT AVG(total_purchase) AS avg_price
                FROM (
                    SELECT user_id, SUM(price_usd) AS total_purchase
                    FROM orders
                    GROUP BY user_id
                ) AS user_purchase
            ),
            VIP AS (
                SELECT o.user_id, SUM(o.price_usd) AS total_purchase, a.avg_price
                FROM orders o
                CROSS JOIN Avg_price a
                GROUP BY o.user_id, a.avg_price
                HAVING SUM(o.price_usd) >= 1.5 * a.avg_price
            ),
            firstlast_order AS (
            	SELECT DISTINCT user_id, min(created_at) AS first_ord_date, max(created_at) AS last_ord_date
            	FROM orders
            	WHERE user_id IN(SELECT user_id FROM VIP)
            	GROUP BY user_id
            	),
            user_od AS(
            	SELECT o.user_id
            	, DATE_FORMAT(fo.first_ord_date,'%Y-%m-01')AS first_order_month
            	, DATE_FORMAT(fo.last_ord_date,'%Y-%m-01')AS last_order_month
              FROM firstlast_order fo
              LEFT JOIN orders o ON o.user_id = fo.user_id
            )
            SELECT first_order_month
            			, COUNT(DISTINCT user_id) AS month0
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 1 MONTH) <= last_order_month THEN user_id END) AS month1
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 2 MONTH) <= last_order_month THEN user_id END) AS month2
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 3 MONTH) <= last_order_month THEN user_id END) AS month3
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 4 MONTH) <= last_order_month THEN user_id END) AS month4
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 5 MONTH) <= last_order_month  THEN user_id END) AS month5
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 6 MONTH) <= last_order_month  THEN user_id END) AS month6
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 7 MONTH) <= last_order_month  THEN user_id END) AS month7
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 8 MONTH) <= last_order_month  THEN user_id END) AS month8
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 9 MONTH) <= last_order_month  THEN user_id  END) AS month9
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 10 MONTH) <= last_order_month  THEN user_id END) AS month10
            	    , COUNT(DISTINCT CASE WHEN DATE_ADD(first_order_month, INTERVAL 11 MONTH) <= last_order_month THEN user_id END) AS month11
            FROM user_od
            GROUP BY first_order_month ORDER BY first_order_month ;
            
            ```
            
        - **전체 고객 및 VIP 그룹의 리텐션 분석(클래식리텐션)**
            
            ```sql
            # 유저별 최초 주문일 검색 테이블
            
            WITH Avg_price AS (
                SELECT AVG(total_purchase) AS avg_price
                FROM (
                    SELECT user_id, SUM(price_usd) AS total_purchase
                    FROM orders
                    GROUP BY user_id
                ) AS user_purchase
            ),
            VIP AS (
                SELECT o.user_id, SUM(o.price_usd) AS total_purchase, a.avg_price
                FROM orders o
                CROSS JOIN Avg_price a
                GROUP BY o.user_id, a.avg_price
                HAVING SUM(o.price_usd) >= 1.5 * a.avg_price
            ),
            
            first_order AS (
            	SELECT DISTINCT user_id,
            			CASE WHEN user_id IN (SELECT user_id
            								FROM vip) THEN 'VIP'
            			ELSE 'Regular' END AS 'User_Segment', min(created_at) AS first_ord
            	FROM orders
            	GROUP BY 1
            ),
            
            # 첫 주문 이후 n개월 주문 여부
            order_month AS (SELECT DISTINCT fo.user_id, User_segment,
            		CASE WHEN created_at = date_format( date_format( first_ord, '%Y-%m-01'), '%Y-%m-01') THEN 0
            		WHEN created_at > date_format( date_format( first_ord, '%Y-%m-01'), '%Y-%m-01') AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 1 month) THEN 1
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 1 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 2 month) THEN 2
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 2 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 3 month) THEN 3
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 3 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 4 month) THEN 4
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 4 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 5 month) THEN 5
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 5 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 6 month) THEN 6
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 6 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 7 month) THEN 7
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 7 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 8 month) THEN 8
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 8 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 9 month) THEN 9
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 9 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 10 month) THEN 10
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 10 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 11 month) THEN 11
            		WHEN created_at > date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 11 month) AND created_at <= date_add(date_format( first_ord, '%Y-%m-01'), INTERVAL 12 month) THEN 12
            		END AS month_num
            
            FROM first_order fo JOIN orders o ON fo.user_id = o.user_id
            ORDER BY month_num desc
            ),
            
            # 추가 주문 순서
            seq_table AS (
            	SELECT user_id, User_segment, month_num
            			FROM order_month
            )
            
            SELECT User_segment,
            		CASE WHEN month_num = 0 THEN 'm-0'
            		WHEN month_num = 1  THEN 'm-1'
            		WHEN month_num = 2  THEN 'm-2'
            		WHEN month_num = 3  THEN 'm-3'
            		WHEN month_num = 4  THEN 'm-4'
            		WHEN month_num = 5  THEN 'm-5'
            		WHEN month_num = 6  THEN 'm-6'
            		WHEN month_num = 7  THEN 'm-7'
            		WHEN month_num = 8  THEN 'm-8'
            		WHEN month_num = 9  THEN 'm-9'
            		WHEN month_num = 10 THEN 'm-10'
            		WHEN month_num = 11 THEN 'm-11'
            		WHEN month_num = 12 THEN 'm-12'
            		ELSE 'unknown'
            		END AS month_range,
            		count(user_id) user_cnt
            FROM seq_table
            GROUP BY 1,2
            ORDER BY 1,2;
            ```
            
    
     
    
    1.  **세분화된 고객 등급별 구매 행동 분석**
        - **분기별 구매고객 추세변화**
            
            ```sql
            #RFM_monthly 
            WITH customer_orders AS (
                SELECT
                    o.user_id,
                    DATE_FORMAT(o.created_at, '%Y-%m') AS order_month, -- 월별 분석
                    CASE
                        WHEN MONTH(o.created_at) BETWEEN 1 AND 3 THEN CONCAT(YEAR(o.created_at), '-Q1_Custom')
                        WHEN MONTH(o.created_at) BETWEEN 4 AND 6 THEN CONCAT(YEAR(o.created_at), '-Q2_Custom')
                        WHEN MONTH(o.created_at) BETWEEN 7 AND 9 THEN CONCAT(YEAR(o.created_at), '-Q3_Custom')
                        WHEN MONTH(o.created_at) BETWEEN 10 AND 12 THEN CONCAT(YEAR(o.created_at), '-Q4_Custom')
                    END AS custom_quarter, -- 사용자 지정 분기
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count,
                    SUM(o.items_purchased) AS total_unit,
                    DATE_FORMAT(MAX(o.created_at), '%Y-%m') AS last_order_month‘
                FROM orders o
                GROUP BY o.user_id, order_month, custom_quarter
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders
            ),
            customer_segments AS (
                SELECT
                    co.user_id,
                    co.order_month,
                    co.custom_quarter,
                    co.total_spent,
                    co.order_count,
                    co.total_unit,
                    co.last_order_month,
                    CASE
                        WHEN co.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Non_VIP'
                    END AS segment
                FROM customer_orders co
            )
            SELECT 
                cs.order_month,
                cs.custom_quarter,
            
                -- VIP 관련 데이터
                ROUND(SUM(CASE WHEN cs.segment = 'VIP' THEN cs.total_spent ELSE 0 END), 0) AS vip_revenue,
                COUNT(DISTINCT CASE WHEN cs.segment = 'VIP' THEN cs.user_id END) AS vip_user_count,
                ROUND(SUM(CASE WHEN cs.segment = 'VIP' THEN cs.order_count ELSE 0 END), 0) AS vip_order_count,
                ROUND(SUM(CASE WHEN cs.segment = 'VIP' THEN cs.order_count ELSE 0 END) / 
                      NULLIF(COUNT(DISTINCT CASE WHEN cs.segment = 'VIP' THEN cs.user_id END), 0), 2) AS vip_freq,
                ROUND(SUM(CASE WHEN cs.segment = 'VIP' THEN cs.total_spent ELSE 0 END) / 
                      NULLIF(COUNT(DISTINCT CASE WHEN cs.segment = 'VIP' THEN cs.user_id END), 0), 0) AS vip_aov,
                ROUND(SUM(CASE WHEN cs.segment = 'VIP' THEN cs.total_unit ELSE 0 END) / 
                      NULLIF(COUNT(DISTINCT CASE WHEN cs.segment = 'VIP' THEN cs.user_id END), 0), 0) AS vip_upm,
            
                -- Non-VIP 관련 데이터
                ROUND(SUM(CASE WHEN cs.segment = 'Non_VIP' THEN cs.total_spent ELSE 0 END), 0) AS non_vip_revenue,
                COUNT(DISTINCT CASE WHEN cs.segment = 'Non_VIP' THEN cs.user_id END) AS non_vip_count,
                ROUND(SUM(CASE WHEN cs.segment = 'Non_VIP' THEN cs.order_count ELSE 0 END), 0) AS non_vip_order_count,
                ROUND(SUM(CASE WHEN cs.segment = 'Non_VIP' THEN cs.order_count ELSE 0 END) / 
                      NULLIF(COUNT(DISTINCT CASE WHEN cs.segment = 'Non_VIP' THEN cs.user_id END), 0), 2) AS non_vip_freq,
                ROUND(SUM(CASE WHEN cs.segment = 'Non_VIP' THEN cs.total_spent ELSE 0 END) / 
                      NULLIF(COUNT(DISTINCT CASE WHEN cs.segment = 'Non_VIP' THEN cs.user_id END), 0), 0) AS non_vip_aov,
                ROUND(SUM(CASE WHEN cs.segment = 'Non_VIP' THEN cs.total_unit ELSE 0 END) / 
                      NULLIF(COUNT(DISTINCT CASE WHEN cs.segment = 'Non_VIP' THEN cs.user_id END), 0), 0) AS non_vip_upm
            
            FROM customer_segments cs
            GROUP BY cs.order_month, cs.custom_quarter
            ORDER BY cs.order_month, cs.custom_quarter;
            
            ```
            
        - **최근 3개월 구매 행동 분석**
            
            ```sql
            WITH recent_orders AS (
                SELECT 
                    o.user_id, 
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count,
                    SUM(o.items_purchased) AS total_items -- 'items_purchased'로 총 구매한 제품 수 합산
                FROM orders o
                WHERE DATE(o.created_at) >= DATE_SUB(DATE('2015-3-19'), INTERVAL 3 MONTH) -- 최근 3개월
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders -- 평균 주문 금액의 1.5배를 VIP 기준으로 설정
            ),
            customer_segments AS (
                SELECT 
                    ro.user_id,
                    ro.total_spent,
                    ro.order_count,
                    ro.total_items, -- 총 제품 수
                    CASE
                        WHEN ro.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Non_VIP'
                    END AS segment
                FROM recent_orders ro
            )
            SELECT 
                cs.segment,
                COUNT(cs.user_id) AS user_count,  -- 세그먼트별 사용자 수
                COALESCE(ROUND(AVG(cs.total_spent / cs.order_count), 2), 0) AS avg_order_value,  -- 세그먼트별 평균 주문 금액 (최근 3개월) 
                COALESCE(SUM(cs.total_spent), 0) AS total_spent_3_months,  -- 세그먼트별 총 구매 금액 (최근 3개월)
                COALESCE(SUM(cs.order_count), 0) AS total_order_count_3_months,  -- 세그먼트별 총 구매 횟수 (최근 3개월)
                COALESCE(SUM(cs.total_items) / COUNT(cs.user_id), 0) AS unit_per_member  -- 세그먼트별 한 사람이 구매한 제품 개수 (UPM)
            FROM customer_segments cs
            GROUP BY cs.segment
            ORDER BY 1 DESC;
            ```
            
        - **그룹별 최근 3개월 간 평균 구매 금액**
            
            ```sql
            WITH recent_orders AS (
                SELECT 
                    o.user_id, 
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count
                FROM orders o
                WHERE DATE(o.created_at) >= DATE_SUB(DATE('2015-03-19'), INTERVAL 3 MONTH)
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders
            ),
            customer_segments AS (
                SELECT 
                    ro.user_id,
                    ro.total_spent,
                    ro.order_count,
                    CASE
                        WHEN ro.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Non_VIP'
                    END AS segment
                FROM recent_orders ro
            )
            SELECT 
            	'2014-12-19 ~ 2015-03-19' AS period,
                cs.segment,
                COALESCE(ROUND(AVG(cs.total_spent / cs.order_count), 0), 0) AS avg_order_value
            FROM customer_segments cs
            GROUP BY cs.segment
            ORDER BY cs.segment DESC;
            ```
            
        - **그룹별 최근 3개월 간 총 매출**
            
            ```sql
            WITH recent_orders AS (
                SELECT 
                    o.user_id, 
                    SUM(o.price_usd) AS total_spent
                FROM orders o
                WHERE DATE(o.created_at) BETWEEN '2014-12-19' AND '2015-03-19'
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders
            ),
            customer_segments AS (
                SELECT 
                    ro.user_id,
                    ro.total_spent,
                    CASE
                        WHEN ro.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Non_VIP'
                    END AS segment
                FROM recent_orders ro
            )
            SELECT 
                '2014-12-19 ~ 2015-03-19' AS period, -- 날짜 범위 추가
                cs.segment,
                COALESCE(ROUND(SUM(cs.total_spent), 0), 0) AS total_spent_3_months
            FROM customer_segments cs
            GROUP BY cs.segment
            ORDER BY cs.segment DESC;
            
            ```
            
        - **그룹별 최근 3개월 간 총 구매 건수**
            
            ```sql
            WITH recent_orders AS (
                SELECT 
                    o.user_id, 
                    SUM(o.price_usd) AS total_spent,  -- 총 구매 금액
                    COUNT(DISTINCT o.order_id) AS order_count  -- 총 주문 횟수
                FROM orders o
                WHERE DATE(o.created_at) >= DATE_SUB(DATE('2015-03-19'), INTERVAL 3 MONTH) -- 최근 3개월
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders -- VIP 기준: 평균 주문 금액 * 1.5
            ),
            customer_segments AS (
                SELECT 
                    ro.user_id,
                    ro.total_spent,
                    ro.order_count,
                    CASE
                        WHEN ro.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Non_VIP'
                    END AS segment
                FROM recent_orders ro
            )
            SELECT 
                '2014-12-19 ~ 2015-03-19' AS period, -- 날짜 범위 추가
                cs.segment,
                COALESCE(SUM(cs.order_count), 0) AS total_order_count_3_months
            FROM customer_segments cs
            GROUP BY cs.segment
            ORDER BY cs.segment DESC;
            ```
            
        - **그룹별 최근 3개월 간 한 사람이 구매한 제품 개수**
            
            ```sql
            WITH recent_orders AS (
                SELECT 
                    o.user_id, 
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count,
                    SUM(o.items_purchased) AS total_items
                FROM orders o
                WHERE DATE(o.created_at) BETWEEN '2014-12-19' AND '2015-03-19' -- 최근 3개월
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders
            ),
            customer_segments AS (
                SELECT 
                    ro.user_id,
                    ro.total_items,
                    CASE
                        WHEN ro.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Non_VIP'
                    END AS segment
                FROM recent_orders ro
            )
            SELECT 
                '2014-12-19 ~ 2015-03-19' AS period, -- 날짜 범위 추가
                cs.segment,
                COALESCE(ROUND(SUM(cs.total_items) / COUNT(cs.user_id), 1), 0) AS unit_per_member -- 세그먼트별 평균 구매 제품 수
            FROM customer_segments cs
            GROUP BY cs.segment
            ORDER BY cs.segment DESC;
            ```
            
    
    1.  **신규 방문자 구매 행동 분석**
        - **기간별 신규 고객 수**
            
            ```sql
            WITH First_Purchases AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2012-03-19' AND '2013-03-18'
                GROUP BY user_id
            ),
            New_Customers_2012 AS (
                SELECT '2012-03-19~2013-03-18' AS period, COUNT(*) AS new_customers
                FROM First_Purchases
            ),
            First_Purchases_2013 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2013-03-19' AND '2014-03-18'
                GROUP BY user_id
                HAVING MIN(created_at) NOT IN (
                    SELECT first_purchase_date FROM First_Purchases
                )
            ),
            New_Customers_2013 AS (
                SELECT '2013-03-19~2014-03-18' AS period, COUNT(*) AS new_customers
                FROM First_Purchases_2013
            ),
            First_Purchases_2014 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2014-03-19' AND '2015-03-19'
                GROUP BY user_id
                HAVING MIN(created_at) NOT IN (
                    SELECT first_purchase_date FROM First_Purchases_2013
                )
            ),
            New_Customers_2014 AS (
                SELECT '2014-03-19~2015-03-19' AS period, COUNT(*) AS new_customers
                FROM First_Purchases_2014
            )
            SELECT * FROM New_Customers_2012
            UNION ALL
            SELECT * FROM New_Customers_2013
            UNION ALL
            SELECT * FROM New_Customers_2014
            ORDER BY period;
            ```
            
        - **기간별 신규 고객 평균 구매액, 평균 제품 구매 개수**
            
            ```sql
            WITH First_Purchases_2012 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2012-03-19' AND '2013-03-18'
                GROUP BY user_id
            ),
            New_Customers_2012 AS (
                SELECT '2012-03-19~2013-03-18' AS period, 
                       ROUND(AVG(o.price_usd), 2) AS new_customer_spent_avg,
                       ROUND(AVG(o.items_purchased), 2) AS new_customer_items_purchased_avg
                FROM First_Purchases_2012 fp
                JOIN orders o ON fp.user_id = o.user_id
            ),
            First_Purchases_2013 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2013-03-19' AND '2014-03-18'
                GROUP BY user_id
                HAVING user_id NOT IN (SELECT user_id FROM First_Purchases_2012)
            ),
            New_Customers_2013 AS (
                SELECT '2013-03-19~2014-03-18' AS period, 
                       ROUND(AVG(o.price_usd), 2) AS new_customer_spent_avg,
                       ROUND(AVG(o.items_purchased), 2) AS new_customer_items_purchased_avg
                FROM First_Purchases_2013 fp
                JOIN orders o ON fp.user_id = o.user_id
            ),
            First_Purchases_2014 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2014-03-19' AND '2015-03-19'
                GROUP BY user_id
                HAVING user_id NOT IN (SELECT user_id FROM First_Purchases_2012)
                       AND user_id NOT IN (SELECT user_id FROM First_Purchases_2013)
            ),
            New_Customers_2014 AS (
                SELECT '2014-03-19~2015-03-19' AS period, 
                       ROUND(AVG(o.price_usd), 2) AS new_customer_spent_avg,
                       ROUND(AVG(o.items_purchased), 2) AS new_customer_items_purchased_avg
                FROM First_Purchases_2014 fp
                JOIN orders o ON fp.user_id = o.user_id
            )
            SELECT * FROM New_Customers_2012
            UNION ALL
            SELECT * FROM New_Customers_2013
            UNION ALL
            SELECT * FROM New_Customers_2014
            ORDER BY period;
            ```
            
        - **기간별 신규 고객이 구매한 제품의 비율**
            
            ```sql
            WITH First_Purchases_2012 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2012-03-19' AND '2013-03-18'
                GROUP BY user_id
            ),
            First_Purchase_Details_2012 AS (
                SELECT o.user_id, 
                       '2012-03-19~2013-03-18' AS period,
                       o.primary_product_id,
                       ROW_NUMBER() OVER (PARTITION BY o.user_id ORDER BY o.created_at) AS rn
                FROM orders o
                JOIN First_Purchases_2012 fp 
                    ON o.user_id = fp.user_id AND o.created_at = fp.first_purchase_date
            ),
            New_Customers_2012 AS (
                SELECT period, primary_product_id
                FROM First_Purchase_Details_2012
                WHERE rn = 1
            ),
            First_Purchases_2013 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2013-03-19' AND '2014-03-18'
                GROUP BY user_id
                HAVING user_id NOT IN (SELECT user_id FROM First_Purchases_2012)
            ),
            First_Purchase_Details_2013 AS (
                SELECT o.user_id, 
                       '2013-03-19~2014-03-18' AS period,
                       o.primary_product_id,
                       ROW_NUMBER() OVER (PARTITION BY o.user_id ORDER BY o.created_at) AS rn
                FROM orders o
                JOIN First_Purchases_2013 fp 
                    ON o.user_id = fp.user_id AND o.created_at = fp.first_purchase_date
            ),
            New_Customers_2013 AS (
                SELECT period, primary_product_id
                FROM First_Purchase_Details_2013
                WHERE rn = 1
            ),
            First_Purchases_2014 AS (
                SELECT user_id, 
                       MIN(created_at) AS first_purchase_date
                FROM orders
                WHERE created_at BETWEEN '2014-03-19' AND '2015-03-19'
                GROUP BY user_id
                HAVING user_id NOT IN (SELECT user_id FROM First_Purchases_2013)
            ),
            First_Purchase_Details_2014 AS (
                SELECT o.user_id, 
                       '2014-03-19~2015-03-19' AS period,
                       o.primary_product_id,
                       ROW_NUMBER() OVER (PARTITION BY o.user_id ORDER BY o.created_at) AS rn
                FROM orders o
                JOIN First_Purchases_2014 fp 
                    ON o.user_id = fp.user_id AND o.created_at = fp.first_purchase_date
            ),
            New_Customers_2014 AS (
                SELECT period, primary_product_id
                FROM First_Purchase_Details_2014
                WHERE rn = 1
            ),
            Product_Counts AS (
                SELECT period, primary_product_id, COUNT(*) AS count
                FROM (
                    SELECT * FROM New_Customers_2012
                    UNION ALL
                    SELECT * FROM New_Customers_2013
                    UNION ALL
                    SELECT * FROM New_Customers_2014
                ) AS combined
                GROUP BY period, primary_product_id
            ),
            Total_Orders_Per_Period AS (
                SELECT period, SUM(count) AS total_orders
                FROM Product_Counts
                GROUP BY period
            )
            SELECT p.period, 
                   p.primary_product_id,  
                   ROUND((p.count / t.total_orders) * 100, 2) AS percentage
            FROM Product_Counts p
            JOIN Total_Orders_Per_Period t 
                ON p.period = t.period
            ORDER BY p.period, p.primary_product_id;
            ```
            
    
    1.  **퍼널 분석(Funnel Analysis) - 이탈률**
        - **고객 그룹별 각 단계 이탈률**
            
            ```sql
            with customer_orders AS (
                SELECT
                    o.user_id,
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count
                FROM orders o
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders -- 평균 주문 금액의 1.5배를 VIP 기준으로 설정(전체 주문 고객의 10%를 VIP라고 정의)
            ),
            customer_segments AS (
                SELECT
                    co.user_id,
                    CASE
                        WHEN co.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        WHEN co.total_spent < (SELECT vip_threshold FROM avg_order_value) THEN 'Non_VIP'
            			END AS segment
                FROM customer_orders co
            ),
            ranked_pageviews as (
            select
            	wp.website_session_id,
            	ws.user_id,
            	ws.created_at,
            	wp.pageview_url,
            	row_number() over (partition by ws.user_id,
            	wp.website_session_id
            order by
            	wp.created_at) as step_num
            from
            	website_sessions ws
            join website_pageviews wp on
            	wp.website_session_id = ws.website_session_id
            ),
            funnel_flow as (
            select
            	rp.website_session_id,
            	rp.user_id,
            	rp.created_at,
            	GROUP_CONCAT(rp.pageview_url order by rp.step_num separator ' → ') as user_funnel_flow
            from
            	ranked_pageviews rp
            group by
            	rp.user_id,
            	rp.website_session_id,
            	rp.created_at
            order by
            	rp.user_id,
            	rp.website_session_id
            )
            select
            	coalesce (cs.segment, 'Non Buyer') as segment,
            	(count(case when ff.user_funnel_flow like '%/home%' or ff.user_funnel_flow like '%lander%' then 1 end)-count(case when ff.user_funnel_flow like '%/products%' then 1 end))/count(case when ff.user_funnel_flow like '%/home%' or ff.user_funnel_flow like '%lander%' then 1 end) * 100 as `/home or /lander → /products`,
            	(count(case when ff.user_funnel_flow like '%/products%' then 1 end)-count(case when ff.user_funnel_flow like '%/the-original-mr-fuzzy%' or ff.user_funnel_flow like '%/the-forever-love-bear%' or ff.user_funnel_flow like '%/the-birthday-sugar-panda%' or ff.user_funnel_flow like '%/the-hudson-river-mini-bear%' then 1 end))/count(case when ff.user_funnel_flow like '%/products%' then 1 end) * 100 as `/products → /product_detail`,
            	(count(case when ff.user_funnel_flow like '%/the-original-mr-fuzzy%' or ff.user_funnel_flow like '%/the-forever-love-bear%' or ff.user_funnel_flow like '%/the-birthday-sugar-panda%' or ff.user_funnel_flow like '%/the-hudson-river-mini-bear%' then 1 end)-count(case when ff.user_funnel_flow like '%/cart%' then 1 end))/count(case when ff.user_funnel_flow like '%/the-original-mr-fuzzy%' or ff.user_funnel_flow like '%/the-forever-love-bear%' or ff.user_funnel_flow like '%/the-birthday-sugar-panda%' or ff.user_funnel_flow like '%/the-hudson-river-mini-bear%' then 1 end) * 100 as `/product_detail → /cart`,
            	(count(case when ff.user_funnel_flow like '%/cart%' then 1 end)-count(case when ff.user_funnel_flow like '%/shipping%' then 1 end))/count(case when ff.user_funnel_flow like '%/cart%' then 1 end) * 100 as `/cart →/shipping`,
            	(count(case when ff.user_funnel_flow like '%/shipping%' then 1 end)-count(case when ff.user_funnel_flow like '%/billing%' then 1 end))/count(case when ff.user_funnel_flow like '%/shipping%' then 1 end) * 100 as `/shipping →/billing`,
            	(count(case when ff.user_funnel_flow like '%/billing%' then 1 end)-count(case when ff.user_funnel_flow like '%/thank-you-for-your-order' then 1 end))/count(case when ff.user_funnel_flow like '%/billing%' then 1 end) * 100 as `/billing →/thank0you-for-your-order`
            from
            	funnel_flow ff
            left join customer_segments cs
            on ff.user_id = cs.user_id 
            group by
            	cs.segment;
            ```
            
        - **고객 그룹별 페이지 체류 시간**
            
            ```sql
            WITH customer_orders AS (
                SELECT
                    o.user_id,
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count
                FROM orders o
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders -- VIP 기준: 평균 주문 금액의 1.5배
            ),
            customer_segments AS (
                SELECT
                    co.user_id,
                    CASE
                        WHEN co.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        ELSE 'Regular Customer'
                    END AS segment
                FROM customer_orders co
            ),
            ranked_pageviews AS (
                SELECT
                    wp.website_session_id,
                    ws.user_id,
                    ws.created_at,
                    wp.pageview_url,
                    wp.created_at AS page_creation,
                    ROW_NUMBER() OVER (PARTITION BY ws.user_id, wp.website_session_id ORDER BY wp.created_at) AS step_num
                FROM website_sessions ws
                JOIN website_pageviews wp ON wp.website_session_id = ws.website_session_id
            ),
            time_diff_calculated AS (
                SELECT 
                    rp.user_id,
                    COALESCE(cs.segment, 'Non Buyer') AS segment,
                    rp.step_num,
                    TIMESTAMPDIFF(SECOND, LAG(rp.page_creation) OVER (PARTITION BY rp.user_id, rp.website_session_id ORDER BY rp.step_num), rp.page_creation) AS time_diff
                FROM ranked_pageviews rp
                LEFT JOIN customer_segments cs ON rp.user_id = cs.user_id
            )
            SELECT 
                segment,
                step_num AS page,
                AVG(time_diff) AS avg_time_on_page
            FROM time_diff_calculated
            WHERE time_diff IS NOT NULL
            GROUP BY segment, step_num
            HAVING COUNT(time_diff) > 0
            ORDER BY segment, step_num;
            ```
            
        - **고객 그룹별 유입 페이지 이탈률**
            
            ```sql
            with customer_orders AS (
                SELECT
                    o.user_id,
                    SUM(o.price_usd) AS total_spent,
                    COUNT(DISTINCT o.order_id) AS order_count
                FROM orders o
                GROUP BY o.user_id
            ),
            avg_order_value AS (
                SELECT AVG(price_usd) * 1.5 AS vip_threshold FROM orders -- 평균 주문 금액의 1.5배를 VIP 기준으로 설정(전체 주문 고객의 10%를 VIP라고 정의)
            ),
            customer_segments AS (
                SELECT
                    co.user_id,
                    CASE
                        WHEN co.total_spent >= (SELECT vip_threshold FROM avg_order_value) THEN 'VIP'
                        WHEN co.total_spent < (SELECT vip_threshold FROM avg_order_value) THEN 'Non_VIP'
            			END AS segment
                FROM customer_orders co
            ),
            ranked_pageviews as (
            select
            	wp.website_session_id,
            	ws.user_id,
            	ws.created_at,
            	wp.pageview_url,
            	row_number() over (partition by ws.user_id,
            	wp.website_session_id
            order by
            	wp.created_at) as step_num
            from
            	website_sessions ws
            join website_pageviews wp on
            	wp.website_session_id = ws.website_session_id
            ),
            funnel_flow as (
            select
            	rp.website_session_id,
            	rp.user_id,
            	rp.created_at,
            	GROUP_CONCAT(rp.pageview_url order by rp.step_num separator ' → ') as user_funnel_flow
            from
            	ranked_pageviews rp
            group by
            	rp.user_id,
            	rp.website_session_id,
            	rp.created_at
            order by
            	rp.user_id,
            	rp.website_session_id
            )
            select
            	coalesce(cs.segment, 'Non-Buyer'),
            	(count(case when ff.user_funnel_flow like '/home%' then 1 end) - count(case when ff.user_funnel_flow like '/home %' then 1 end)) / count(case when ff.user_funnel_flow like '/home%' then 1 end) * 100 as `/home`,
            	(count(case when ff.user_funnel_flow like '/lander-1%' then 1 end) - count(case when ff.user_funnel_flow like '/lander-1 %' then 1 end)) / count(case when ff.user_funnel_flow like '/lander-1%' then 1 end) * 100 as `/lander-1`,
            	(count(case when ff.user_funnel_flow like '/lander-2%' then 1 end) - count(case when ff.user_funnel_flow like '/lander-2 %' then 1 end)) / count(case when ff.user_funnel_flow like '/lander-2%' then 1 end) * 100 as `/lander-2`,
            	(count(case when ff.user_funnel_flow like '/lander-3%' then 1 end) - count(case when ff.user_funnel_flow like '/lander-3 %' then 1 end)) / count(case when ff.user_funnel_flow like '/lander-3%' then 1 end) * 100 as `/lander-3`,
            	(count(case when ff.user_funnel_flow like '/lander-4%' then 1 end) - count(case when ff.user_funnel_flow like '/lander-4 %' then 1 end)) / count(case when ff.user_funnel_flow like '/lander-4%' then 1 end) * 100 as `/lander-4`,
            	(count(case when ff.user_funnel_flow like '/lander-5%' then 1 end) - count(case when ff.user_funnel_flow like '/lander-5 %' then 1 end)) / count(case when ff.user_funnel_flow like '/lander-5%' then 1 end) * 100 as `/lander-5`
            from
            	funnel_flow ff
            left join customer_segments cs
            on ff.user_id = cs.user_id 
            group by
            	cs.segment;
            ```